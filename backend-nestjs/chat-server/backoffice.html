<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Back-Office Livreur - Chat Temps R√©el</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f8fafc; margin: 0; padding: 0; }
    .container { max-width: 420px; margin: 40px auto; background: rgba(255,255,255,0.95); border-radius: 18px; box-shadow: 0 8px 32px rgba(0,0,0,0.12); padding: 24px; }
    .header { display: flex; align-items: center; gap: 12px; margin-bottom: 18px; }
    .avatar { width: 48px; height: 48px; border-radius: 50%; border: 2px solid #22c55e; }
    .messages { min-height: 220px; max-height: 320px; overflow-y: auto; margin-bottom: 16px; display: flex; flex-direction: column; gap: 8px; }
    .bubble { display: inline-block; padding: 10px 16px; border-radius: 18px; max-width: 75%; font-size: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
    .bubble.driver { background: #e0f7fa; color: #036666; align-self: flex-start; }
    .bubble.client { background: #e6ffe6; color: #1b4332; align-self: flex-end; }
    .typing { color: #888; font-size: 13px; margin-left: 8px; }
    .input-row { display: flex; gap: 8px; }
    .input-row input[type="text"] { flex: 1; padding: 8px 12px; border-radius: 12px; border: 1px solid #ccc; font-size: 15px; }
    .input-row button { padding: 8px 18px; border-radius: 12px; border: none; background: #22c55e; color: #fff; font-weight: bold; font-size: 15px; cursor: pointer; transition: background 0.2s; }
    .input-row button:hover { background: #16a34a; }
    .name-row { display: flex; gap: 8px; margin-bottom: 12px; }
    .name-row input { flex: 1; padding: 6px 10px; border-radius: 10px; border: 1px solid #bbb; font-size: 14px; }
    .name-row button { padding: 6px 14px; border-radius: 10px; border: none; background: #3b82f6; color: #fff; font-weight: bold; font-size: 14px; cursor: pointer; }
    .name-row button:hover { background: #2563eb; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img id="avatar" class="avatar" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Livreur" />
      <div>
        <div id="driverName" style="font-weight:bold;font-size:18px;">Jean Livreur</div>
        <div style="font-size:13px;color:#22c55e;">Back-Office Livreur</div>
      </div>
      <button onclick="window.location.reload()" style="margin-left:auto;padding:7px 18px;border-radius:12px;background:#3b82f6;color:#fff;font-weight:bold;font-size:15px;border:none;cursor:pointer;">üè† Accueil</button>
    </div>
    <div class="name-row">
      <input id="nameInput" type="text" placeholder="Nom du livreur" value="Jean Livreur" />
      <button onclick="setName()">Changer</button>
    </div>
    <div class="messages" id="messages"></div>
    <div id="typing" class="typing" style="display:none;">Le client est en train d'√©crire...</div>
    <form class="input-row" id="form">
      <input id="input" autocomplete="off" placeholder="√âcrire un message..." />
      <button type="submit">Envoyer</button>
    </form>
  </div>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script>
    let driverName = 'Jean Livreur';
    let avatarUrl = 'https://randomuser.me/api/portraits/men/32.jpg';
    const socket = io('http://localhost:4000');
    const messages = document.getElementById('messages');
    const form = document.getElementById('form');
    const input = document.getElementById('input');
    const typingDiv = document.getElementById('typing');
    let typingTimeout;

    function setName() {
      const nameInput = document.getElementById('nameInput');
      driverName = nameInput.value || 'Jean Livreur';
      document.getElementById('driverName').textContent = driverName;
      avatarUrl = `https://randomuser.me/api/portraits/men/${Math.floor(Math.random()*99)}.jpg`;
      document.getElementById('avatar').src = avatarUrl;
    }

    function addMessage(msg) {
      const div = document.createElement('div');
      div.className = 'bubble ' + (msg.from === 'driver' ? 'driver' : 'client');
      div.innerHTML = `<b>${msg.from === 'driver' ? driverName : 'Client'}</b> <span style="font-size:12px;color:#888;">${msg.time}</span><br>${msg.text}`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      if (input.value) {
        const msg = {
          from: 'driver',
          text: input.value,
          time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
        };
        socket.emit('chat message', msg);
        addMessage(msg);
        input.value = '';
        socket.emit('stop typing', 'driver');
      }
    });

    input.addEventListener('input', function() {
      if (input.value) {
        socket.emit('typing', 'driver');
        clearTimeout(typingTimeout);
        typingTimeout = setTimeout(() => socket.emit('stop typing', 'driver'), 2000);
      } else {
        socket.emit('stop typing', 'driver');
      }
    });

    socket.on('chat message', function(msg) {
      if (msg.from === 'client') addMessage(msg);
    });
    socket.on('typing', function(user) {
      if (user === 'client') typingDiv.style.display = '';
    });
    socket.on('stop typing', function(user) {
      if (user === 'client') typingDiv.style.display = 'none';
    });
  </script>
</body>
</html> 